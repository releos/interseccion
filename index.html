<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Intersección</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <!-- Librería para generar PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #111827; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.6s ease-out forwards; }
        .tab-button.active { background-color: #4f46e5; color: #ffffff; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .modal-content-scroll::-webkit-scrollbar { width: 8px; }
        .modal-content-scroll::-webkit-scrollbar-track { background: #1f2937; }
        .modal-content-scroll::-webkit-scrollbar-thumb { background: #4f46e5; border-radius: 4px; }
    </style>
</head>
<body class="text-gray-200">
    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-extrabold text-white tracking-tight">La Intersección</h1>
            <p class="mt-2 text-lg text-gray-400">Un juego de misterios semanales.</p>
        </header>

        <nav class="flex justify-center border-b border-gray-700 mb-8">
            <button data-tab="en-curso" class="tab-button text-gray-300 hover:bg-gray-700/50 font-semibold py-3 px-6 transition active">Misterios en Curso</button>
            <button data-tab="archivo" class="tab-button text-gray-300 hover:bg-gray-700/50 font-semibold py-3 px-6 transition">Archivo de Soluciones</button>
            <button data-tab="sobre" class="tab-button text-gray-300 hover:bg-gray-700/50 font-semibold py-3 px-6 transition">Sobre el Proyecto</button>
        </nav>

        <main>
            <div id="en-curso" class="tab-content grid grid-cols-1 md:grid-cols-2 gap-6 min-h-[100px]"></div>
            <div id="archivo" class="tab-content hidden grid grid-cols-1 md:grid-cols-2 gap-6 min-h-[100px]"></div>
            <div id="sobre" class="tab-content hidden">
                 <div class="space-y-8 fade-in">
                    <div class="bg-gray-800 rounded-xl shadow-lg p-8">
                        <h2 class="text-3xl font-bold text-indigo-400 mb-4">¿Qué es "La Intersección"?</h2>
                        <p class="text-gray-300 leading-relaxed">Este es un pequeño proyecto de entretenimiento inspirado en el famoso concurso "Saber y Ganar". El objetivo es adivinar "la intersección" —que puede ser una persona, un lugar, una película, una canción o cualquier cosa imaginable— a partir de pequeñas pistas que se irán revelando semanalmente. Es un reto a la paciencia, la deducción y la cultura general.</p>
                    </div>
                    <div class="grid md:grid-cols-5 gap-8">
                        <div class="md:col-span-3 bg-gray-800 rounded-xl shadow-lg p-8">
                            <h3 class="text-2xl font-bold text-indigo-400 mb-6">¿Cómo se juega?</h3>
                            <ol class="space-y-5">
                                <li class="flex"><div class="flex-shrink-0 bg-indigo-600 rounded-full text-white font-bold w-8 h-8 flex items-center justify-center mr-4">1</div><div class="pt-1">Visita la pestaña <strong>Misterios en Curso</strong> o el <strong>Archivo</strong> para elegir un juego.</div></li>
                                <li class="flex"><div class="flex-shrink-0 bg-indigo-600 rounded-full text-white font-bold w-8 h-8 flex items-center justify-center mr-4">2</div><div class="pt-1">Si está resuelto, puedes elegir entre ver la solución directamente o jugar pista a pista.</div></li>
                                <li class="flex"><div class="flex-shrink-0 bg-indigo-600 rounded-full text-white font-bold w-8 h-8 flex items-center justify-center mr-4">3</div><div class="pt-1">Cuando creas tener la solución (en un juego en curso), ¡usa el formulario para enviarla!</div></li>
                                <li class="flex"><div class="flex-shrink-0 bg-indigo-600 rounded-full text-white font-bold w-8 h-8 flex items-center justify-center mr-4">4</div><div class="pt-1">Puedes descargar un resumen de cada misterio en PDF en cualquier momento.</div></li>
                            </ol>
                        </div>
                        <div class="md:col-span-2 bg-gray-800 rounded-xl shadow-lg p-8 flex flex-col">
                             <h3 class="text-2xl font-bold text-indigo-400 mb-6">Contacto y Opiniones</h3>
                             <div class="space-y-4 flex-grow flex flex-col justify-center">
                                <a href="https://www.instagram.com/" target="_blank" rel="noopener noreferrer" class="group flex items-center gap-4 bg-gray-700/50 hover:bg-gray-700 p-4 rounded-lg transition-all">
                                     <div class="flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center bg-gradient-to-br from-purple-600 via-pink-600 to-yellow-500"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="text-white" viewBox="0 0 16 16"><path d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.917 3.917 0 0 0-1.417.923A3.927 3.927 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.916 3.916 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.926 3.926 0 0 0-.923-1.417A3.917 3.917 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0h.003zM8 4a4 4 0 1 1 0 8 4 4 0 0 1 0-8zm0 1.442a2.558 2.558 0 1 0 0 5.116 2.558 2.558 0 0 0 0-5.116z"/></svg></div>
                                     <div><div class="font-bold text-white">Instagram</div><div class="text-sm text-gray-400 group-hover:text-gray-200 transition">Sigue el juego</div></div>
                                 </a>
                                 <a href="#" target="_blank" rel="noopener noreferrer" class="group flex items-center gap-4 bg-gray-700/50 hover:bg-gray-700 p-4 rounded-lg transition-all">
                                     <div class="flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center bg-blue-500"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="text-white" viewBox="0 0 16 16"><path d="M2 2.5A2.5 2.5 0 0 1 4.5 0h8.75a.75.75 0 0 1 0 1.5H4.5A1 1 0 0 0 3.5 3h10a1 1 0 0 0 1-1 .75.75 0 0 1 1.5 0v1A1.5 1.5 0 0 1 14.5 4h-13A1.5 1.5 0 0 1 0 2.5v-1A1.5 1.5 0 0 1 1.5 0H2z"/><path d="M16 5.5a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 5.5v-1A1.5 1.5 0 0 1 1.5 3H2a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1h.5a1.5 1.5 0 0 1 1.5 1.5v1zM1.5 9h13a.5.5 0 0 1 0 1h-13a.5.5 0 0 1 0-1zm0 2.5h13a.5.5 0 0 1 0 1h-13a.5.5 0 0 1 0-1z"/></svg></div>
                                     <div><div class="font-bold text-white">Dame tu opinión</div><div class="text-sm text-gray-400 group-hover:text-gray-200 transition">Formulario de feedback</div></div>
                                 </a>
                             </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Structure -->
    <div id="game-modal" class="modal fixed inset-0 bg-black bg-opacity-80 items-center justify-center p-4 z-50"><div class="bg-gray-800 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col"><header class="flex-shrink-0 p-4 border-b border-gray-700 flex justify-between items-center"><h2 id="modal-title" class="text-2xl font-bold text-white"></h2><button id="modal-close-btn" class="text-gray-400 hover:text-white text-3xl leading-none">&times;</button></header><div id="modal-content" class="p-6 overflow-y-auto modal-content-scroll"></div></div></div>

    <script>
        const dom = {
            tabs: document.querySelectorAll('.tab-button'), tabContents: document.querySelectorAll('.tab-content'), enCursoContainer: document.getElementById('en-curso'), archivoContainer: document.getElementById('archivo'),
            modal: document.getElementById('game-modal'), modalTitle: document.getElementById('modal-title'), modalContent: document.getElementById('modal-content'), modalCloseBtn: document.getElementById('modal-close-btn'),
        };

        const GAMES_INDEX_PATH = 'games/index.json';

        function getVisibleClues(game) {
            if (!game.clues || game.isSolved) return game.clues || [];
            const now = new Date();
            // Assuming CET is UTC+2 during summer, UTC+1 during winter. For simplicity, we can approximate or use a library.
            // A simple approximation is to treat stored time as local and compare to user's local time.
            // For true CET, a library like `date-fns-tz` would be needed, which is too heavy for this.
            // We'll proceed assuming the user inputs time in their local timezone which is CET.
            return game.clues.filter(clue => clue.publishDate && new Date(clue.publishDate) <= now);
        }

        function renderSummaryCard(game) {
            const statusPill = game.isSolved ? `<span class="bg-green-500 text-white text-xs font-semibold px-2 py-1 rounded-full">Resuelto</span>` : `<span class="bg-yellow-500 text-gray-900 text-xs font-semibold px-2 py-1 rounded-full">En curso</span>`;
            const startDate = game.startDate ? new Date(game.startDate).toLocaleDateString('es-ES', { day: 'numeric', month: 'short', year: 'numeric' }) : '';
            const endDate = game.endDate ? new Date(game.endDate).toLocaleDateString('es-ES', { day: 'numeric', month: 'short', year: 'numeric' }) : '';
            const dateText = game.isSolved ? `Del ${startDate.replace(/ de/g, '')} al ${endDate.replace(/ de/g, '')}` : `Iniciado: ${startDate.replace(/ de/g, '')}`;
            const descriptionHTML = game.notes ? `<p class="text-sm text-gray-400 mt-2 italic">${game.notes}</p>` : '';
            const card = document.createElement('div');
            card.className = 'bg-gray-800/80 hover:bg-gray-800 transition-colors cursor-pointer rounded-xl shadow-lg p-5 flex flex-col justify-between fade-in';
            card.innerHTML = `<div><div class="flex justify-between items-start mb-2"><h3 class="text-xl font-bold text-white pr-2">${game.title || 'Misterio sin título'}</h3>${statusPill}</div>${descriptionHTML}<p class="text-sm text-gray-500 mt-3">Pistas reveladas: ${getVisibleClues(game).length}</p></div><div class="mt-4 border-t border-gray-700 pt-3 text-right"><p class="text-xs text-gray-500">${dateText}</p></div>`;
            card.addEventListener('click', () => openModalWithGame(game));
            return card;
        }

        function renderClue(clue, index) {
            let mainTextHTML = '', mediaHTML = '';
            if (clue.type === 'text') { mainTextHTML = `<p>${clue.content || ''}</p>`; } 
            else if (clue.text) { mainTextHTML = `<p>${clue.text}</p>`; }
            if (clue.type !== 'text' && clue.content) {
                let url = clue.content;
                if (!/^https?:\/\//i.test(url)) { url = 'https://' + url; }
                switch (clue.type) {
                    case 'image': mediaHTML = `<img src="${url}" alt="Pista" class="mt-2 rounded-lg w-full h-auto object-cover max-h-96">`; break;
                    case 'audio': mediaHTML = `<audio controls src="${url}" class="mt-2 w-full"></audio>`; break;
                    case 'video': mediaHTML = `<video controls muted playsinline src="${url}" class="mt-2 rounded-lg w-full" onerror="this.outerHTML='<div class=\\'text-red-400 text-sm p-2 bg-red-900/50 rounded-lg\\'>Error al cargar el vídeo.</div>'"></video>`; break;
                    case 'link': mediaHTML = `<a href="${url}" target="_blank" rel="noopener noreferrer" class="mt-2 inline-flex items-center gap-2 bg-indigo-600 hover:bg-indigo-500 text-white font-semibold py-2 px-4 rounded-lg transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1.002 1.002 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4.018 4.018 0 0 1-.128-1.287z"/><path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243L6.586 4.672z"/></svg><span>Abrir Enlace</span></a>`; break;
                }
            }
            return `<div class="flex items-start gap-4 p-4 bg-gray-700/50 rounded-lg"><div class="flex-shrink-0 bg-indigo-600 h-8 w-8 rounded-full flex items-center justify-center font-bold text-white text-sm">${index + 1}</div><div class="flex-grow prose prose-invert max-w-none prose-p:text-gray-300 text-sm">${mainTextHTML}${mediaHTML}</div></div>`;
        }

        function getSolutionHTML(game) {
            const explanationHTML = game.explanation ? `<p>${game.explanation.replace(/\n/g, '<br>')}</p>` : '<p>No se proporcionó una explicación.</p>';
            return `<div class="mt-6 border-t-2 border-green-500 pt-6 space-y-4"><h3 class="text-2xl font-bold text-green-400">Solución Final</h3><div class="bg-green-900/50 border border-green-500 rounded-lg p-6 text-center"><p class="text-4xl font-extrabold text-white break-words">${game.solution || 'N/A'}</p>${game.winner ? `<p class="text-lg text-yellow-400 mt-2">¡Adivinado por <strong>${game.winner}</strong>!</p>` : ''}</div><div class="prose prose-invert max-w-none prose-p:text-gray-300 prose-headings:text-white prose-headings:text-xl"><h4>Explicación</h4>${explanationHTML}</div></div>`;
        }
        
        function renderModalContent(game, mode = 'full', clueIndex = -1) {
            dom.modalTitle.textContent = game.title || 'Misterio';
            const availableClues = getVisibleClues(game);

            if (mode === 'pre-solved') {
                const contentHTML = `<div class="text-center space-y-4 p-4"><p>Este misterio ya ha sido resuelto.</p><div class="flex flex-col sm:flex-row justify-center gap-4"><button id="play-solved-btn" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-2 px-4 rounded-lg">Jugar pista a pista</button><button id="show-solution-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg">Mostrar solución completa</button></div></div>`;
                dom.modalContent.innerHTML = contentHTML;
                document.getElementById('play-solved-btn').addEventListener('click', () => renderModalContent(game, 'step-by-step', 0));
                document.getElementById('show-solution-btn').addEventListener('click', () => renderModalContent(game, 'full'));
            } else if (mode === 'step-by-step') {
                const cluesToShow = availableClues.slice(0, clueIndex + 1);
                const cluesHTML = cluesToShow.map((clue, i) => renderClue(clue, i)).join('');
                let ctaHTML = '';
                if (clueIndex < availableClues.length - 1) {
                    ctaHTML = `<div class="text-center mt-6"><button id="next-clue-btn" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-2 px-4 rounded-lg">Mostrar siguiente pista</button></div>`;
                } else {
                    ctaHTML = `<div class="text-center mt-6"><button id="reveal-solution-btn" class="bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-4 rounded-lg">Mostrar Solución</button></div>`;
                }
                dom.modalContent.innerHTML = `<div id="pdf-content" class="space-y-4">${cluesHTML}</div>${ctaHTML}`;

                if (document.getElementById('next-clue-btn')) { document.getElementById('next-clue-btn').addEventListener('click', () => renderModalContent(game, 'step-by-step', clueIndex + 1)); }
                if (document.getElementById('reveal-solution-btn')) { document.getElementById('reveal-solution-btn').addEventListener('click', () => renderModalContent(game, 'full')); }
            } else { // 'full' mode
                const allCluesHTML = availableClues.map((clue, i) => renderClue(clue, i)).join('');
                const solutionHTML = game.isSolved ? getSolutionHTML(game) : '';
                const ctaHTML = `<div class="mt-8 text-center flex flex-col sm:flex-row justify-center gap-4">${game.googleFormLink && !game.isSolved ? `<a href="${game.googleFormLink}" target="_blank" rel="noopener noreferrer" class="inline-block bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg">¡Adivina aquí!</a>` : ''}<button id="download-pdf-btn" class="inline-flex items-center justify-center gap-2 bg-gray-600 hover:bg-gray-500 text-white font-bold py-3 px-8 rounded-lg shadow-lg"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/><path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/></svg>Descargar PDF</button></div>`;
                dom.modalContent.innerHTML = `<div id="pdf-content">${allCluesHTML}${solutionHTML}</div>${ctaHTML}`;
                if (document.getElementById('download-pdf-btn')) { document.getElementById('download-pdf-btn').addEventListener('click', () => downloadGameAsPDF(game)); }
            }
        }
        
        function openModalWithGame(game) {
            if (game.isSolved) { renderModalContent(game, 'pre-solved'); } 
            else { renderModalContent(game, 'full'); }
            dom.modal.classList.add('active');
        }
        
        function closeModal() { dom.modal.classList.remove('active'); dom.modalTitle.textContent = ''; dom.modalContent.innerHTML = ''; }

        function downloadGameAsPDF(game) {
            const element = document.createElement('div');
            const showSolution = game.isSolved;
            
            const visibleClues = getVisibleClues(game);
            const renderPdfClue = (clue, index) => {
                let mainTextHTML = ''; let mediaHTML = '';
                if (clue.type === 'text') { mainTextHTML = `<p>${clue.content || ''}</p>`; } 
                else if (clue.text) { mainTextHTML = `<p>${clue.text}</p>`; }
                if (clue.type !== 'text' && clue.content) {
                    let url = clue.content; if (!/^https?:\/\//i.test(url)) { url = 'https://' + url; }
                    mediaHTML = `<p style="font-size: 0.8rem; color: #4f46e5;"><em>[Recurso externo: ${url}]</em></p>`;
                }
                return `<div style="margin-bottom: 1rem; padding: 1rem; border: 1px solid #e5e7eb; border-radius: 0.5rem;"><h3 style="font-size: 1.25rem; font-weight: 700; color: #1f2937; margin-bottom: 0.5rem;">Pista ${index + 1}</h3><div style="font-size: 1rem; line-height: 1.6;">${mainTextHTML}${mediaHTML}</div></div>`;
            };
            const allCluesHTML = visibleClues.map((clue, i) => renderPdfClue(clue, i)).join('');
            
            let solutionHTML = '';
            if (showSolution) {
                const explanationHTML = game.explanation ? `<p style="line-height: 1.6;">${game.explanation.replace(/\n/g, '<br>')}</p>` : '<p>No se proporcionó una explicación.</p>';
                solutionHTML = `<div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 2px solid #4f46e5;"><h2 style="font-size: 1.875rem; font-weight: 800; color: #16a34a;">Solución Final</h2><div style="margin-top: 1rem; padding: 1.5rem; background-color: #f0fdf4; border-radius: 0.5rem; text-align: center;"><p style="font-size: 2.25rem; font-weight: 800; color: #15803d; word-wrap: break-word;">${game.solution || 'N/A'}</p>${game.winner ? `<p style="margin-top: 0.5rem; color: #b45309;">¡Adivinado por <strong>${game.winner}</strong>!</p>` : ''}</div><div style="margin-top: 1.5rem;"><h4 style="font-size: 1.5rem; font-weight: 700;">Explicación</h4>${explanationHTML}</div></div>`;
            }
            element.innerHTML = `<div style="padding: 2rem; font-family: 'Inter', sans-serif; color: #111827; background-color: #ffffff;"><h1 style="font-size: 2.5rem; font-weight: 800; text-align: center; margin-bottom: 0.5rem;">${game.title}</h1><p style="text-align: center; margin-bottom: 2rem; font-style: italic; color: #6b7280;">${game.notes || ''}</p><div style="margin-top: 1rem;">${allCluesHTML}</div>${solutionHTML}</div>`;
            
            const opt = { margin: 0, filename: `${game.title.replace(/ /g, '_')}.pdf`, image: { type: 'jpeg', quality: 0.98 }, html2canvas: { scale: 2, useCORS: true }, jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' } };
            html2pdf().from(element).set(opt).save();
        }

        async function loadGames() {
            const loadingHTML = '<p class="text-center text-gray-400 col-span-full">Cargando misterios...</p>';
            dom.enCursoContainer.innerHTML = loadingHTML; dom.archivoContainer.innerHTML = loadingHTML;
            try {
                const response = await fetch(`${GAMES_INDEX_PATH}?v=${Date.now()}`);
                if (!response.ok) throw new Error(`El archivo de índice no se encuentra en ${GAMES_INDEX_PATH}`);
                const gameFiles = await response.json();
                if (!Array.isArray(gameFiles)) throw new Error("El índice de juegos no es un array válido.");
                const gamePromises = gameFiles.map(async (file) => {
                    try { const res = await fetch(`games/${file}?v=${Date.now()}`); if (!res.ok) throw new Error(`No se pudo cargar ${file}`); return await res.json(); } 
                    catch (error) { console.error(`Error procesando el archivo de juego ${file}:`, error); return null; }
                });
                const games = (await Promise.all(gamePromises)).filter(Boolean);
                dom.enCursoContainer.innerHTML = ''; dom.archivoContainer.innerHTML = '';
                games.sort((a, b) => new Date(b.lastUpdated) - new Date(a.lastUpdated));
                let enCursoCount = 0, archivoCount = 0;
                games.forEach(game => {
                    if (game && game.title) {
                        const card = renderSummaryCard(game);
                        if (game.isSolved) { dom.archivoContainer.appendChild(card); archivoCount++; } 
                        else { dom.enCursoContainer.appendChild(card); enCursoCount++; }
                    }
                });
                if (enCursoCount === 0) dom.enCursoContainer.innerHTML = '<p class="text-center text-gray-400 col-span-full">Aún no hay misterios en curso. ¡Vuelve pronto!</p>';
                if (archivoCount === 0) dom.archivoContainer.innerHTML = '<p class="text-center text-gray-400 col-span-full">Aún no hay misterios resueltos.</p>';
            } catch (error) {
                console.error("Error al cargar el índice de juegos:", error);
                const errorHTML = `<p class="text-center text-red-500 col-span-full">Error fatal al cargar los juegos. Revisa la consola (F12).</p>`;
                dom.enCursoContainer.innerHTML = errorHTML; dom.archivoContainer.innerHTML = '';
            }
        }
        
        function init() {
            dom.tabs.forEach(tab => {
                tab.addEventListener('click', (event) => {
                    const targetId = event.currentTarget.dataset.tab;
                    dom.tabs.forEach(t => t.classList.remove('active'));
                    event.currentTarget.classList.add('active');
                    dom.tabContents.forEach(contentPanel => {
                        if (contentPanel.id === targetId) { contentPanel.classList.remove('hidden'); } 
                        else { contentPanel.classList.add('hidden'); }
                    });
                });
            });
            dom.modalCloseBtn.addEventListener('click', closeModal);
            dom.modal.addEventListener('click', (e) => { if (e.target === dom.modal) closeModal(); });
            document.addEventListener('keydown', (e) => { if (e.key === "Escape" && dom.modal.classList.contains('active')) closeModal(); });
            loadGames();
        }
        init();
    </script>
</body>
</html>
